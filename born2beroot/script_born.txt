==== configuration for your sudo group, dentro /etc/sudoers.d/sudo_config ====

# Total tries for entering the sudo password.
Defaults passwd_tries=3

# The message that will show when the password failed.
Defaults badpass_message="Bad Password"

# Path where will the sudo logs will be stored.
Defaults logfile="/var/log/sudo/sudo_gonfig"

# What will be logged.
Defaults log_input, log_output

# What will be logged.
Defaults iolog_dir="/var/log/sudo"

# TTY become required
Defaults requiretty

# Folders that will be excluded of sudo
Defaults secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin"




# dentro /etc/login.defs

PASS_MAX_DAYS   30	(This parameter sets the expiration time for passwords, with the number 
representing the duration in days.)

PASS_MIN_DAYS   2	(Here, you define the minimum number of days a password must be used before 
it can be changed.)

PASS_WARN_AGE   7	(This setting triggers a warning message to users, notifying them of the 
impending expiration of their password within the specified number of days.)


# dentro nano /etc/pam. d/common-password
 After retry=3 we must add the following commands:
 
	minlen=10: Sets the minimum number of characters required for a password.

	ucredit=-1: Specifies that the password must include at least one uppercase letter.

	dcredit=-1: Requires the presence of at least one digit in the password.

	lcredit=-1: Ensures the password contains at least one lowercase letter.

	maxrepeat=3: Limits the repetition of the same character to a maximum of 3 times consecutively.

	reject_username: Prohibits the password from containing the username.

	difok=7: Specifies that at least 7 characters in the new password must differ from the old password.

	enforce_for_root: Enforces these password policies for the root user, enhancing security even for privileged accounts.



# script

1) Display the sistem architecture: 
	arch=$(uname -a)

2) Physical cores: to determine the number of physical cores, access the file /proc/cpuinfo, which provides CPU infprmations
   such as type, brand, model, and performance. 
	cpuf=$(grep "physical id" /proc/cpuinfo | wc -l) 

3) Virtual Cores: access the file /proc/cpuinfo. 
	cpuv$=(grep "processor" /proc/cpuinfo | wc -l)

4) RAM: ram_total=$(free --mega | awk '$1 == "Mem:" {print $3}') prints the used memory. (prints the third word of each line)
	ram_use=$(free --mega | awk '$1 == "Mem:" {print $2}') prints the total memory. (prints the second word of each line)
	ram_percent=$(free --mega | awk '$1 == "Mem:" {printf("(%.2f%%)\n", $3/$2*100)}'). (calculate the percentage of used memory)

5) Disk Memory: df = summary of disk space usage
		-m flag = display memory metrics in MB
disk_total=$(df -m | grep "/dev/" | grep -v "/boot" | awk '{memory_use += $3} END {print memory_use}'). (sums up the memory usage)
disk_use=$(df -m | grep "/dev/" | grep -v "/boot" | awk '{total_size += $2} END {print total_size/1024}'). (total disk space)
disk_percent=$(df -m | grep "/dev/" | grep -v "/boot" | awk '{use += $3} {total += $2} END {printf("(%.2f%%)\n", use/total*100)}'). 
	(display the percentage of used memory)

6) CPU Usage Percentage
	cpul=$(vmstat 1 4 | tail -1 | awk '{print $15}'). (utilize the vmstat command to obtain system statistics. Specify an interval
						   and use tail to select the last line of output. Then, use awk to print the
						   desired column)
	(Subtract the value obtained from 100 to determine the CPU usage percentage. Print the result with one decimal place
	 and a "%" symbol. This operation completes the script.) COMANDO: expr 100 - $cpul (<-- = comando sopra)
	 cpu_op=$(expr 100 - $cpul)
	 cpu_fin=$(printf "%.1f", cpu_op)

7) Last Reboot
	lb=&(who -b | awk '$1 == "system" {print $3 " " $4}'). (prints the last reboot date and time)
	
8) LVM Active
	lvmu=$(if [ $(lsblk | grep "lvm" | wc -l) -gt 0 ]; then echo yes; else echo no; fi).
	(lsblk shows the block device information. filter the output to find LVM using grep. based on the result, yes or no)

9) TCP Connections:	ss = determine the number of established TCP connections
			-ta flag = display only TCP connections
			grep = toidentify established connections
			wc -l = count the number of lines
	tcpc=$(ss -ta | grep ESTAB | wc -l)

10) Number of Users:	users = displays the names of active users
			wc -w = count the number of words in the command output
	ulog=$(users | wc -w)
	
11) IP Address & MAC:	hostname -l = obtain the host's IP address
			ip link = shows or modifies network interfaces
			grep... = display only the MAC address
	ip=&(hostname -I)
	mac=&(ip link | grep "link/ether" | awk '{print $2}') to display only the MAC address
	
12) Number of commands executed with sudo:	jounalctl = collects and manages system logs
						_COMM=sudo = filter entries by the specified path
						grep.. = display only command lines
						wc -l to count lines
	cmnd=$(journalctl _COMM=sudo | grep COMMAND | wc -l)
	(To verify its correctness, execute the command in the terminal, run a sudo command, and then rerun the command to
	 confirm that the count increases.)


wall "	Architecture: $arch
	CPU physical: $cpuf
	vCPU: $cpuv
	Memory Usage: $ram_use/${ram_total}MB ($ram_percent%)
	Disk Usage: $disk_use/${disk_total} ($disk_percent%)
	CPU load: $cpu_fin%
	Last boot: $lb
	LVM use: $lvmu
	Connections TCP: %tcpc ESTABLISHED
	User log: $ulog
	Network: IP $ip ($mac)
	Sudo: $cmnd cmd"









=====SCRIPT COMPLETO=====
#!/bin/bash

# ARCHITECTURE
arch=$(uname -a)

# PHYSICAL CORES
cpuf=$(grep "physical id" /proc/cpuinfo | wc -l) 

# VIRTUAL CORES
cpuv=$(grep "processor" /proc/cpuinfo | wc -l)

# RAM
ram_total=$(free --mega | awk '$1 == "Mem:" {print $2}')
ram_use=$(free --mega | awk '$1 == "Mem:" {print $3}')
ram_percent=$(free --mega | awk '$1 == "Mem:" {printf("%.2f"), $3/$2*100}')

# DISK MEMORY
disk_total=$(df -m | grep "/dev/" | grep -v "/boot" | awk '{disk_t += $2} END {printf ("%.1fGb\n"), disk_t/1024}')
disk_use=$(df -m | grep "/dev/" | grep -v "/boot" | awk '{disk_u += $3} END {print disk_u}')
disk_percent=$(df -m | grep "/dev/" | grep -v "/boot" | awk '{disk_u += $3} {disk_t+= $2} END {printf("%d"), disk_u/disk_t*100}')

# CPU Usage Percentage
cpul=$(vmstat 1 2 | tail -1 | awk '{print $15}')
cpu_op=$(expr 100 - $cpul)
cpu_fin=$(printf "%.1f", $cpu_op)

# Last Reboot
lb=$(who -b | awk '$1 == "system" {print $3 " " $4}')

# LVM Active
lvmu=$(if [ $(lsblk | grep "lvm" | wc -l) -gt 0 ]; then echo yes; else echo no; fi)

# TCP Connections
tcpc=$(ss -ta | grep ESTAB | wc -l)

# Number of Users
ulog=$(users | wc -w)

# IP Address & MAC
ip=$(hostname -I)
mac=$(ip link | grep "link/ether" | awk '{print $2}')

# Number of commands executed with sudo
cmnd=$(journalctl _COMM=sudo | grep COMMAND | wc -l)

wall "  Architecture: $arch
        CPU physical: $cpuf
        vCPU: $cpuv
        Memory Usage: $ram_use/${ram_total}MB ($ram_percent%)
        Disk Usage: $disk_use/${disk_total} ($disk_percent%)
        CPU load: $cpu_fin%
        Last boot: $lb
        LVM use: $lvmu
        Connections TCP: $tcpc ESTABLISHED
        User log: $ulog
        Network: IP $ip ($mac)
        Sudo: $cmnd cmd"




===== WORDPRESS =====

$ sudo apt install lighttpd
$ sudo ufw allow 80
$ sudo apt install wget zip
$ cd /var/www/
$ sudo wget https://wordpress.org/latest.zip
$ sudo unzip latest.zip
$ sudo mv html/ html_old/
$ sudo mv wordpress/ html
$ sudo chmod -R 755 html

MARIADB
$ sudo apt install mariadb-server
$ sudo mysql_secure_installation
$ mariadb
	CREATE DATABASE wp_database;
	CREATE USER 'elguiduc'@'localhost' IDENTIFIED BY '12345';
	GRANT ALL PRIVILEGES ON wp_database.* TO 'elguiduc'@'localhost';
	FLUSH PRIVILEGES;
	exit

PHP
$ sudo apt install php-cgi php-mysql (scarico pacchetti)
$ cd /var/www/html
$ cp wp-config-sample.php wp-config.php
$ nano wp-config.php
	cambiare da "database_name_here" "username_here" "password_here"
	a "wp_database" "elguiduc" "12345"
$ sudo lighty-enable-mod fastcgi
$ sudo lighty-enable-mod fastcgi-php
$ sudo service lighttpd force-reload
	(Activate the fastcgi-php module in Lighttpd to enhance the performance and speed of web
	 applications on the server, and update it in the end)

Go to your browser and type localhost:8080
Fill on the fields and press on Install WordPress
If we access our localhost again from the browser, we can observe our functional page.



===== SFTP (Secure File Transfer Protocol) =====

provides a secure way to transfer files securely over a network.

Subsystem       sftp    /usr/lib/openssh/sftp-server
	se questa riga non c'e' va aggiunta e poi sudo service sshd restart
	
sudo adduser sftp_user (Nuovouser1)
	non e' consigliato usare il proprio user perche' ha accesso alla she;;, puo' navigare tutto il 
	filesystem, puo' eseguire comandi, se e' compromesso puo' compromettere tutto il server
		=> molto insicuro
	creo un nuovo user che ha accesso limitato solo ai file, nessuna shell, directory isolata (chroot)
	
sudo chown root:root /home/sftp_user
	You can restrict SFTP users to a specific chroot directory for enhanced security.

sudo systemctl restart ssh
sudo systemctl status ssh










